    'two_stage_opamp': {
        # 训练设置
        'epochs_pretrain': 1000,
        'patience_pretrain': 200,
        'lr_pretrain': 3e-3,
        'epochs_finetune': 100000,
        'patience_finetune': 1000,
        'lr_finetune': 3.8e-3,
        'batch_a': 128,
        'batch_b': 64,
        'ensemble_alpha': [0.7, 0.7, 0.3, 0.7, 0.85],
        # 模型设置
        'hidden_dim': 256,
        'num_layers': 4,
        'dropout_rate': 0.2,

        # 损失函数权重
        'lambda_coral': 0.02,
        'alpha_r2': 0,
        # 反向模型
        'mdn_components': 20,
        'mdn_hidden_dim': 128,
        'mdn_num_layers': 3,
        'mdn_epochs': 500,
        'mdn_lr': 1e-3,
        'mdn_batch_size': 256,
        'mdn_weight_decay': 1e-5,
        # ====== B阶段主干微调用 ======
        'use_tail_sampler_B': False,
       # 'tail_focus_cols_B': 'cmrr',
        #'tail_gamma_B': 3.5,

        'use_student_t_B': True,
        'student_t_nu_B':3.8,

        'use_coral_decay_B': True,
        'lambda_coral_start_B': 0.02,
        'lambda_coral_end_B': 0.02,
        'lambda_coral_decay_mode_B': 'linear',

        'cmrr_loss_boost_B': 6.0,
        'dcgain_loss_boost_B': 1.0,

        'freeze_backbone_epochs_B': 60,

        'logvar_min': -6.0,
        'logvar_max': 0.8,
        'logvar_reg': 1e-3,
        'anchor_huber': 0.75,

        # ====== 预处理截尾 / 清洗 ======
        'cmrr_db_cap': 125.0,
        'cmrr_cap_scope': 'all',
        'cmrr_outlier_mode': 'winsor',
       # 'cmrr_outlier_q': 0.999,    # 可以留着以防以后切 'drop'

        'dc_gain_cap': 10000.0,
        'dc_gain_outlier_mode': 'winsor',

        # ====== cmrr 残差 MoE 后处理 ======
        'cmrr_residual_enabled': True,
        'cmrr_residual_hidden': 128,
        'cmrr_residual_layers': 2,
        'cmrr_residual_dropout': 0.1,
        'cmrr_residual_epochs': 800,
        'cmrr_residual_patience': 120,
        'cmrr_residual_lr': 1e-3,

        'cmrr_tail_quantile': 0.90,
        'cmrr_tail_weight': 6.0,

        'cmrr_moe_k': 2,
        'cmrr_moe_init': 10,
        'cmrr_moe_max_iter': 300,
        'cmrr_iso_enabled': True,

        # ====== dc_gain 残差 MoE 后处理 ======
        'dc_gain_residual_enabled': True,

        'dc_gain_moe_k': 2,
        'dc_gain_moe_min_cluster': 60,

        'dc_gain_tail_quantile': 0.80,
        'dc_gain_tail_weight': 8.0,

        'dc_gain_residual_hidden': 128,
        'dc_gain_residual_layers': 2,
        'dc_gain_residual_dropout': 0.10,
        'dc_gain_residual_epochs': 800,
        'dc_gain_residual_patience': 120,
        'dc_gain_residual_lr': 3e-4,

        'dc_gain_iso_enabled': False,

    },
aftermoe:
--- [评估阶段] 开始计算指标 ---

=== 目标域验证集指标（物理单位）===
slewrate_pos    MSE=1.737e+14  MAE=9.679e+06  R2=0.5950
dc_gain         MSE=2.794e+06  MAE=625  R2=0.5804
ugf             MSE=1.131e+14  MAE=7.096e+06  R2=0.7444
phase_margin    MSE=187.3  MAE=10.12  R2=0.8368
cmrr            MSE=1.616e+10  MAE=3.128e+04  R2=0.4280

Avg  (all dims)   MSE=5.736e+13  MAE=3.361e+06  R2=0.6369
[Evaluate-B+MoE+Iso Focus] cmrr    R2=0.6238  MAE=28215.2

============================================================
=== PIPELINE FINISHED (multi-target residual MoE) ===
============================================================

============================================================
=== PIPELINE FINISHED ===
============================================================